# ChatBI é¡¹ç›®å®Œæ•´æŒ‡å—

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

**ChatBI** æ˜¯ä¸€ä¸ªæ™ºèƒ½æ•°æ®åˆ†æå¯¹è¯ç³»ç»Ÿï¼Œæ¨¡ä»¿è…¾è®¯äº‘ ChatBI çš„æ ¸å¿ƒåŠŸèƒ½ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡è‡ªç„¶è¯­è¨€ä¸ç³»ç»Ÿå¯¹è¯ï¼Œå¿«é€Ÿè·å–æ•°æ®åˆ†æç»“æœã€ç”Ÿæˆå¯è§†åŒ–æŠ¥å‘Šã€‚

### æ ¸å¿ƒç‰¹æ€§
- âœ… è‡ªç„¶è¯­è¨€æŸ¥è¯¢ï¼ˆNLQï¼‰- ç”¨æˆ·ç”¨ä¸­æ–‡æé—®ï¼Œç³»ç»Ÿè‡ªåŠ¨ç”ŸæˆSQLå¹¶è¿”å›ç»“æœ
- âœ… å¤šæ•°æ®æºæ”¯æŒ - MySQL æ•°æ®åº“å’Œ Excel æ–‡ä»¶
- âœ… æ™ºèƒ½æ¨¡å¼åˆ‡æ¢ - "æ™ºèƒ½é—®æ•°"å’Œ"ç”ŸæˆæŠ¥å‘Š"ä¸¤ç§æ¨¡å¼
- âœ… å¤šè½®å¯¹è¯ - æ”¯æŒä¼šè¯ç®¡ç†å’Œä¸Šä¸‹æ–‡è®°å¿†
- âœ… æ•°æ®å‡†å¤‡ - æ•°æ®æºç®¡ç†ã€æ•°æ®è¡¨é…ç½®ã€å­—å…¸è¡¨ç»´æŠ¤
- âœ… æƒé™æ§åˆ¶ - è¡Œçº§å’Œåˆ—çº§æƒé™ç®¡ç†
- âœ… æŸ¥è¯¢ç¼“å­˜ - è‡ªåŠ¨ç¼“å­˜æŸ¥è¯¢ç»“æœï¼Œæå‡æ€§èƒ½

---

## ğŸš€ å¿«é€Ÿå¯åŠ¨æŒ‡å—

### å‰ç½®æ¡ä»¶
```bash
# ç¡®ä¿å·²å®‰è£…ä»¥ä¸‹è½¯ä»¶
- Python 3.12+
- Node.js 18+
- npm 8+
- MySQL 8+
```

### æ–¹å¼ä¸€ï¼šä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
# 1. è¿›å…¥é¡¹ç›®æ ¹ç›®å½•
cd /Users/zhanh391/PC/ChatBI

# 2. å¯åŠ¨æ‰€æœ‰æœåŠ¡ï¼ˆè‡ªåŠ¨å¤„ç†è™šæ‹Ÿç¯å¢ƒã€ä¾èµ–ã€æ•°æ®åº“ï¼‰
./scripts/start.sh

# 3. è®¿é—®åº”ç”¨
# å‰ç«¯: http://localhost:3000
# åç«¯ API: http://localhost:8000
# API æ–‡æ¡£: http://localhost:8000/docs

# 4. åœæ­¢æœåŠ¡
./scripts/stop.sh
```

### æ–¹å¼äºŒï¼šæ‰‹åŠ¨å¯åŠ¨

#### æ­¥éª¤ 1: åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
```bash
cd backend
python3 -m venv .venv
source .venv/bin/activate
pip install -e .
```

#### æ­¥éª¤ 2: åˆå§‹åŒ–æ•°æ®åº“
```bash
# å¯åŠ¨ MySQL
brew services start mysql

# åˆå§‹åŒ–æ•°æ®åº“ï¼ˆåˆ›å»ºè¡¨å’Œåˆå§‹æ•°æ®ï¼‰
mysql -u root < database/init.sql
```

#### æ­¥éª¤ 3: å¯åŠ¨åç«¯æœåŠ¡
```bash
cd backend
uvicorn src.main:app --host 0.0.0.0 --port 8000 --reload
```

#### æ­¥éª¤ 4: å¯åŠ¨å‰ç«¯æœåŠ¡
```bash
cd frontend
npm install
npm run dev
```

---

## ğŸ‘¥ ç”¨æˆ·æµç¨‹ï¼ˆUser Flowï¼‰

### åœºæ™¯ 1: æ–°ç”¨æˆ·é¦–æ¬¡ä½¿ç”¨

```
1. ç”¨æˆ·è®¿é—® http://localhost:3000
   â†“
2. ç³»ç»Ÿæ˜¾ç¤ºæ¬¢è¿ç•Œé¢
   - å·¦ä¾§å¯¼èˆªèœå•
   - ä¸­å¤®å¯¹è¯å·¥ä½œå°
   - å³ä¾§é…ç½®æŠ½å±‰ï¼ˆé»˜è®¤å…³é—­ï¼‰
   â†“
3. ç”¨æˆ·ç‚¹å‡»"æ•°æ®åˆ†æ" â†’ "æ•°æ®æº"
   â†“
4. ç”¨æˆ·åˆ›å»ºæ•°æ®æº
   - è¾“å…¥è¿æ¥ä¿¡æ¯ï¼ˆä¸»æœºã€ç«¯å£ã€ç”¨æˆ·åã€å¯†ç ã€æ•°æ®åº“åï¼‰
   - ç‚¹å‡»"æµ‹è¯•è¿æ¥"éªŒè¯
   - ç‚¹å‡»"ä¿å­˜"åˆ›å»ºæ•°æ®æº
   â†“
5. ç³»ç»Ÿè‡ªåŠ¨æ¿€æ´»æ–°æ•°æ®æº
   â†“
6. ç”¨æˆ·è¿”å›å¯¹è¯å·¥ä½œå°
   â†“
7. ç”¨æˆ·åœ¨è¾“å…¥æ¡†è¾“å…¥é—®é¢˜ï¼ˆå¦‚ï¼š"2024å¹´é”€å”®é¢æ˜¯å¤šå°‘ï¼Ÿ"ï¼‰
   â†“
8. ç³»ç»Ÿå¤„ç†æŸ¥è¯¢
   - è§£æè‡ªç„¶è¯­è¨€
   - ç”Ÿæˆ SQL è¯­å¥
   - æ‰§è¡ŒæŸ¥è¯¢
   - ç”Ÿæˆå›¾è¡¨
   â†“
9. ç³»ç»Ÿæ˜¾ç¤ºç»“æœ
   - å·¦ä¾§æ˜¾ç¤º AI å›å¤
   - åŒ…å«å›¾è¡¨å’Œæ•°æ®è¡¨æ ¼
   - æä¾›åˆ·æ–°ã€ç‚¹èµã€ç‚¹è¸©æ“ä½œ
   â†“
10. ç”¨æˆ·å¯ä»¥ç»§ç»­æé—®æˆ–æŸ¥çœ‹å†å²è®°å½•
```

### åœºæ™¯ 2: ç”¨æˆ·åˆ‡æ¢æŸ¥è¯¢æ¨¡å¼

```
1. ç”¨æˆ·åœ¨è¾“å…¥æ¡†ä¸Šæ–¹çœ‹åˆ°"æ¨¡å¼åˆ‡æ¢"å¼€å…³
   â†“
2. ç”¨æˆ·ç‚¹å‡»å¼€å…³ä»"æ™ºèƒ½é—®æ•°"åˆ‡æ¢åˆ°"ç”ŸæˆæŠ¥å‘Š"
   â†“
3. ç³»ç»Ÿæ›´æ–° chatMode çŠ¶æ€
   â†“
4. ç”¨æˆ·è¾“å…¥é—®é¢˜
   â†“
5. ç³»ç»Ÿä»¥"ç”ŸæˆæŠ¥å‘Š"æ¨¡å¼å¤„ç†
   - è¿”å›ç»“æ„åŒ–æŠ¥å‘Š
   - åŒ…å«å¤šä¸ªå›¾è¡¨å’Œåˆ†æ
   â†“
6. ç³»ç»Ÿæ˜¾ç¤ºå®Œæ•´æŠ¥å‘Š
```

### åœºæ™¯ 3: ç”¨æˆ·ç®¡ç†æƒé™

```
1. ç”¨æˆ·ç‚¹å‡»å³ä¸Šè§’"é…ç½®"æŒ‰é’®
   â†“
2. å³ä¾§é…ç½®æŠ½å±‰æ»‘å‡º
   â†“
3. ç”¨æˆ·ç‚¹å‡»"æƒé™é…ç½®"
   â†“
4. ç”¨æˆ·é…ç½®ï¼š
   - åŠŸèƒ½æƒé™ï¼ˆæŸ¥è¯¢ã€æŠ¥å‘Šã€å¯¼å‡ºï¼‰
   - æ•°æ®è¡¨æƒé™ï¼ˆé€‰æ‹©å¯è®¿é—®çš„è¡¨ï¼‰
   â†“
5. ç³»ç»Ÿä¿å­˜æƒé™é…ç½®
   â†“
6. åç»­æŸ¥è¯¢æ—¶è‡ªåŠ¨æ£€æŸ¥æƒé™
```

### åœºæ™¯ 4: ç”¨æˆ·æŸ¥çœ‹æŸ¥è¯¢å†å²

```
1. ç”¨æˆ·ç‚¹å‡»"å†å²"æŒ‰é’®
   â†“
2. ç³»ç»Ÿæ˜¾ç¤ºå†å²æŸ¥è¯¢åˆ—è¡¨
   - æŸ¥è¯¢æ–‡æœ¬
   - æŸ¥è¯¢æ—¶é—´
   - ç»“æœæ‘˜è¦
   â†“
3. ç”¨æˆ·ç‚¹å‡»å†å²é¡¹
   â†“
4. ç³»ç»Ÿé‡æ–°åŠ è½½è¯¥æŸ¥è¯¢ç»“æœï¼ˆä»ç¼“å­˜ï¼‰
   â†“
5. ç”¨æˆ·å¯ä»¥ä¿®æ”¹æŸ¥è¯¢æˆ–ç»§ç»­æé—®
```

---

## ğŸ”„ æ•°æ®æµç¨‹ï¼ˆData Flowï¼‰

### æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å‰ç«¯å±‚ (Vue 3)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ç”¨æˆ·ç•Œé¢                                          â”‚  â”‚
â”‚  â”‚ - NavigationSidebar (å·¦ä¾§å¯¼èˆª)                    â”‚  â”‚
â”‚  â”‚ - ChatInterface (å¯¹è¯å·¥ä½œå°)                      â”‚  â”‚
â”‚  â”‚ - ConfigDrawer (é…ç½®æŠ½å±‰)                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                        â†“                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Pinia Store (çŠ¶æ€ç®¡ç†)                            â”‚  â”‚
â”‚  â”‚ - chat.ts (å¯¹è¯çŠ¶æ€)                              â”‚  â”‚
â”‚  â”‚ - ui.ts (UI çŠ¶æ€)                                 â”‚  â”‚
â”‚  â”‚ - dataPrep.ts (æ•°æ®å‡†å¤‡çŠ¶æ€)                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                        â†“                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ å·¥å…·å‡½æ•°                                          â”‚  â”‚
â”‚  â”‚ - debounce.ts (é˜²æŠ–)                              â”‚  â”‚
â”‚  â”‚ - throttle.ts (èŠ‚æµ)                              â”‚  â”‚
â”‚  â”‚ - cache.ts (ç¼“å­˜)                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“ HTTP/REST
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   åç«¯å±‚ (FastAPI)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ API è·¯ç”±                                          â”‚  â”‚
â”‚  â”‚ - /api/query (æŸ¥è¯¢å¤„ç†)                           â”‚  â”‚
â”‚  â”‚ - /api/sessions (ä¼šè¯ç®¡ç†)                        â”‚  â”‚
â”‚  â”‚ - /api/datasources (æ•°æ®æºç®¡ç†)                   â”‚  â”‚
â”‚  â”‚ - /api/data-prep (æ•°æ®å‡†å¤‡)                       â”‚  â”‚
â”‚  â”‚ - /api/history (å†å²è®°å½•)                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                        â†“                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ä¸šåŠ¡é€»è¾‘å±‚                                        â”‚  â”‚
â”‚  â”‚ - QueryService (æŸ¥è¯¢å¤„ç†)                         â”‚  â”‚
â”‚  â”‚ - SessionService (ä¼šè¯ç®¡ç†)                       â”‚  â”‚
â”‚  â”‚ - DataSourceService (æ•°æ®æºç®¡ç†)                  â”‚  â”‚
â”‚  â”‚ - DatabaseService (æ•°æ®åº“è¿æ¥)                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                        â†“                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ é…ç½®ç®¡ç†                                          â”‚  â”‚
â”‚  â”‚ - config.py (ç¯å¢ƒå˜é‡é…ç½®)                        â”‚  â”‚
â”‚  â”‚ - .env (é…ç½®æ–‡ä»¶)                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“ SQL
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   æ•°æ®å±‚ (MySQL)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ æ•°æ®åº“è¡¨                                          â”‚  â”‚
â”‚  â”‚ - users (ç”¨æˆ·è¡¨)                                  â”‚  â”‚
â”‚  â”‚ - data_sources (æ•°æ®æºè¡¨)                         â”‚  â”‚
â”‚  â”‚ - query_sessions (ä¼šè¯è¡¨)                         â”‚  â”‚
â”‚  â”‚ - query_history (æŸ¥è¯¢å†å²è¡¨)                      â”‚  â”‚
â”‚  â”‚ - dictionary_table (å­—å…¸è¡¨)                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŸ¥è¯¢æµç¨‹è¯¦è§£

```
ç”¨æˆ·è¾“å…¥æŸ¥è¯¢
    â†“
[å‰ç«¯] ç”¨æˆ·åœ¨è¾“å…¥æ¡†è¾“å…¥é—®é¢˜
    â†“
[å‰ç«¯] ç‚¹å‡»å‘é€æŒ‰é’®
    â†“
[å‰ç«¯] Chat Store æ£€æŸ¥ç¼“å­˜
    â”œâ”€ ç¼“å­˜å‘½ä¸­ â†’ ç›´æ¥è¿”å›ç¼“å­˜ç»“æœ â†’ æ˜¾ç¤ºç»“æœ
    â””â”€ ç¼“å­˜æœªå‘½ä¸­ â†’ ç»§ç»­
    â†“
[å‰ç«¯] æ„å»ºè¯·æ±‚ Payload
    {
      "text": "2024å¹´é”€å”®é¢æ˜¯å¤šå°‘ï¼Ÿ",
      "session_id": "session_123",
      "data_source_id": "ds_1",
      "mode": "query"  // æˆ– "report"
    }
    â†“
[å‰ç«¯] å‘é€ POST /api/query è¯·æ±‚
    â†“
[åç«¯] QueryService æ¥æ”¶è¯·æ±‚
    â†“
[åç«¯] NLU æ¨¡å—è§£æè‡ªç„¶è¯­è¨€
    - è¯†åˆ«æ„å›¾ï¼ˆæŸ¥è¯¢ã€æŠ¥å‘Šç­‰ï¼‰
    - æå–å®ä½“ï¼ˆæ—¶é—´ã€æŒ‡æ ‡ç­‰ï¼‰
    - è¯†åˆ«æ•°æ®æº
    â†“
[åç«¯] SQL ç”Ÿæˆæ¨¡å—
    - æ ¹æ®è§£æç»“æœç”Ÿæˆ SQL
    - ç¤ºä¾‹: SELECT SUM(amount) FROM sales WHERE year=2024
    â†“
[åç«¯] æƒé™æ£€æŸ¥
    - æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰æƒè®¿é—®è¯¥è¡¨
    - æ£€æŸ¥è¡Œçº§æƒé™
    - æ£€æŸ¥åˆ—çº§æƒé™
    â†“
[åç«¯] DatabaseService æ‰§è¡Œ SQL
    - ä»è¿æ¥æ± è·å–è¿æ¥
    - æ‰§è¡Œ SQL æŸ¥è¯¢
    - è¿”å›ç»“æœé›†
    â†“
[åç«¯] ç»“æœå¤„ç†
    - æ ¼å¼åŒ–æ•°æ®
    - æ¨æ–­å›¾è¡¨ç±»å‹
    - ç”Ÿæˆæ‘˜è¦æ–‡æœ¬
    â†“
[åç«¯] è¿”å›å“åº”
    {
      "result": {
        "data": [...],
        "chart_type": "bar",
        "explanation": "2024å¹´é”€å”®é¢ä¸º..."
      }
    }
    â†“
[å‰ç«¯] Chat Store æ¥æ”¶å“åº”
    â†“
[å‰ç«¯] ç¼“å­˜æŸ¥è¯¢ç»“æœ
    - ä½¿ç”¨ "æŸ¥è¯¢æ–‡æœ¬|æ•°æ®æºID" ä½œä¸ºé”®
    - å­˜å‚¨ç»“æœå’Œæ—¶é—´æˆ³
    â†“
[å‰ç«¯] æ·»åŠ æ¶ˆæ¯åˆ°æ¶ˆæ¯æµ
    - ç”¨æˆ·æ¶ˆæ¯ï¼ˆå³ä¾§ï¼‰
    - AI å“åº”ï¼ˆå·¦ä¾§ï¼ŒåŒ…å«å›¾è¡¨ï¼‰
    â†“
[å‰ç«¯] æ˜¾ç¤ºç»“æœç»™ç”¨æˆ·
    - æ¸²æŸ“å›¾è¡¨
    - æ˜¾ç¤ºæ•°æ®è¡¨æ ¼
    - æä¾›æ“ä½œæŒ‰é’®ï¼ˆåˆ·æ–°ã€ç‚¹èµã€ç‚¹è¸©ï¼‰
```

### æ•°æ®æºç®¡ç†æµç¨‹

```
ç”¨æˆ·åˆ›å»ºæ•°æ®æº
    â†“
[å‰ç«¯] ç”¨æˆ·å¡«å†™è¿æ¥ä¿¡æ¯
    {
      "name": "é”€å”®æ•°æ®åº“",
      "type": "mysql",
      "host": "localhost",
      "port": 3306,
      "user": "root",
      "password": "***",
      "database": "sales_db"
    }
    â†“
[å‰ç«¯] ç”¨æˆ·ç‚¹å‡»"æµ‹è¯•è¿æ¥"
    â†“
[å‰ç«¯] å‘é€ POST /api/datasources/test
    â†“
[åç«¯] DataSourceService æµ‹è¯•è¿æ¥
    - ä½¿ç”¨æä¾›çš„é…ç½®åˆ›å»ºä¸´æ—¶è¿æ¥
    - æ‰§è¡Œç®€å•æŸ¥è¯¢éªŒè¯
    - è¿”å›æµ‹è¯•ç»“æœ
    â†“
[å‰ç«¯] æ ¹æ®æµ‹è¯•ç»“æœ
    â”œâ”€ æˆåŠŸ â†’ å¯ç”¨"ä¿å­˜"æŒ‰é’®ï¼Œæ˜¾ç¤ºæˆåŠŸæç¤º
    â””â”€ å¤±è´¥ â†’ ç¦ç”¨"ä¿å­˜"æŒ‰é’®ï¼Œæ˜¾ç¤ºé”™è¯¯æç¤º
    â†“
[å‰ç«¯] ç”¨æˆ·ç‚¹å‡»"ä¿å­˜"
    â†“
[å‰ç«¯] å‘é€ POST /api/datasources
    â†“
[åç«¯] ä¿å­˜æ•°æ®æºé…ç½®åˆ°æ•°æ®åº“
    â†“
[å‰ç«¯] DataPrep Store æ›´æ–°æ•°æ®æºåˆ—è¡¨
    â†“
[å‰ç«¯] è‡ªåŠ¨æ¿€æ´»æ–°æ•°æ®æº
    â†“
[å‰ç«¯] æ˜¾ç¤ºæˆåŠŸæç¤º
```

### ä¼šè¯ç®¡ç†æµç¨‹

```
ç”¨æˆ·åˆ›å»ºæ–°ä¼šè¯
    â†“
[å‰ç«¯] ç”¨æˆ·ç‚¹å‡»"æ–°å»ºä¼šè¯"
    â†“
[å‰ç«¯] å‘é€ POST /api/sessions
    {
      "user_id": 1,
      "session_id": null,
      "conversation": []
    }
    â†“
[åç«¯] SessionService åˆ›å»ºä¼šè¯
    - ç”Ÿæˆå”¯ä¸€ session_id
    - åˆå§‹åŒ–ç©ºçš„ conversation æ•°ç»„
    - ä¿å­˜åˆ°æ•°æ®åº“
    â†“
[å‰ç«¯] Chat Store æ›´æ–°å½“å‰ä¼šè¯
    - è®¾ç½® currentSessionId
    - æ¸…ç©ºæ¶ˆæ¯åˆ—è¡¨
    â†“
[å‰ç«¯] æ˜¾ç¤ºæ–°ä¼šè¯
    - æ˜¾ç¤ºæ¬¢è¿è¯­
    - æ˜¾ç¤ºæ¨èé—®é¢˜
    â†“
ç”¨æˆ·å‘é€æ¶ˆæ¯
    â†“
[å‰ç«¯] æ¶ˆæ¯æ·»åŠ åˆ° messages æ•°ç»„
    â†“
[åç«¯] æ¶ˆæ¯ä¿å­˜åˆ° query_sessions è¡¨
    - æ›´æ–° conversation JSON å­—æ®µ
    - æ›´æ–° last_active æ—¶é—´æˆ³
    â†“
[å‰ç«¯] æ¶ˆæ¯æ˜¾ç¤ºåœ¨å¯¹è¯æµä¸­
```

### ç¼“å­˜æœºåˆ¶

```
æŸ¥è¯¢ç¼“å­˜é”®ç”Ÿæˆ
    â†“
ç¼“å­˜é”® = "æŸ¥è¯¢æ–‡æœ¬|æ•°æ®æºID"
ç¤ºä¾‹: "2024å¹´é”€å”®é¢æ˜¯å¤šå°‘ï¼Ÿ|ds_1"
    â†“
æŸ¥è¯¢æ—¶æ£€æŸ¥ç¼“å­˜
    â”œâ”€ ç¼“å­˜å­˜åœ¨ â†’ ç›´æ¥è¿”å›ç¼“å­˜ç»“æœï¼ˆæ— éœ€è°ƒç”¨åç«¯ï¼‰
    â””â”€ ç¼“å­˜ä¸å­˜åœ¨ â†’ è°ƒç”¨åç«¯ API
    â†“
åç«¯è¿”å›ç»“æœå
    â†“
[å‰ç«¯] å°†ç»“æœå­˜å‚¨åˆ°ç¼“å­˜
    {
      "2024å¹´é”€å”®é¢æ˜¯å¤šå°‘ï¼Ÿ|ds_1": {
        "result": {...},
        "timestamp": 2026-01-16T...
      }
    }
    â†“
ç¼“å­˜ä¼˜åŠ¿
    - å‡å°‘ç½‘ç»œè¯·æ±‚
    - æå‡å“åº”é€Ÿåº¦
    - é™ä½åç«¯è´Ÿè½½
```

---

## ğŸ“Š çŠ¶æ€ç®¡ç†ï¼ˆPinia Storesï¼‰

### Chat Store (chat.ts)

**èŒè´£**: ç®¡ç†å¯¹è¯ç›¸å…³çš„æ‰€æœ‰çŠ¶æ€

**å…³é”®çŠ¶æ€**:
```typescript
{
  currentSessionId: string | null,      // å½“å‰ä¼šè¯ ID
  sessions: Session[],                  // æ‰€æœ‰ä¼šè¯åˆ—è¡¨
  messages: Message[],                  // å½“å‰ä¼šè¯çš„æ¶ˆæ¯
  inputText: string,                    // è¾“å…¥æ¡†æ–‡æœ¬
  currentDataSource: string | null,     // å½“å‰é€‰ä¸­çš„æ•°æ®æº
  chatMode: 'query' | 'report',         // å¯¹è¯æ¨¡å¼
  recommendedQuestions: string[],       // æ¨èé—®é¢˜åˆ—è¡¨
  queryHistory: QueryHistory[],         // æŸ¥è¯¢å†å²
  queryCache: Map<string, CachedResult> // æŸ¥è¯¢ç¼“å­˜
}
```

**å…³é”®æ–¹æ³•**:
- `sendMessage()` - å‘é€æŸ¥è¯¢
- `createSession()` - åˆ›å»ºæ–°ä¼šè¯
- `switchSession()` - åˆ‡æ¢ä¼šè¯
- `toggleChatMode()` - åˆ‡æ¢æ¨¡å¼
- `clearMessages()` - æ¸…ç©ºæ¶ˆæ¯
- `loadHistory()` - åŠ è½½å†å²è®°å½•

### UI Store (ui.ts)

**èŒè´£**: ç®¡ç† UI ç›¸å…³çš„å…¨å±€çŠ¶æ€

**å…³é”®çŠ¶æ€**:
```typescript
{
  isConfigDrawerOpen: boolean,           // é…ç½®æŠ½å±‰æ˜¯å¦æ‰“å¼€
  isReportTemplateModalOpen: boolean,    // æŠ¥å‘Šæ¨¡æ¿ Modal
  isKnowledgeBaseModalOpen: boolean,     // çŸ¥è¯†åº“ Modal
  isLoading: boolean,                    // æ˜¯å¦åŠ è½½ä¸­
  loadingMessage: string,                // åŠ è½½æ¶ˆæ¯
  toastMessage: string,                  // Toast æ¶ˆæ¯
  toastType: 'success' | 'error' | ...,  // Toast ç±»å‹
  isSidebarCollapsed: boolean            // ä¾§è¾¹æ æ˜¯å¦æŠ˜å 
}
```

**å…³é”®æ–¹æ³•**:
- `toggleConfigDrawer()` - åˆ‡æ¢é…ç½®æŠ½å±‰
- `setLoading()` - è®¾ç½®åŠ è½½çŠ¶æ€
- `showToast()` - æ˜¾ç¤º Toast é€šçŸ¥
- `openReportTemplateModal()` - æ‰“å¼€æŠ¥å‘Šæ¨¡æ¿ Modal

### DataPrep Store (dataPrep.ts)

**èŒè´£**: ç®¡ç†æ•°æ®å‡†å¤‡ç›¸å…³çš„çŠ¶æ€

**å…³é”®çŠ¶æ€**:
```typescript
{
  dataSources: DataSource[],             // æ•°æ®æºåˆ—è¡¨
  activeDataSourceId: string | null,     // æ´»è·ƒæ•°æ®æº ID
  dataTables: DataTable[],               // æ•°æ®è¡¨åˆ—è¡¨
  dictionaries: DictionaryEntry[],       // å­—å…¸è¡¨
  permissions: {...},                    // æƒé™é…ç½®
  tablePermissions: string[],            // è¡¨çº§æƒé™
  dataSourceCache: {...}                 // æ•°æ®æºç¼“å­˜
}
```

**å…³é”®æ–¹æ³•**:
- `loadDataSources()` - åŠ è½½æ•°æ®æºï¼ˆå¸¦ç¼“å­˜ï¼‰
- `createDataSource()` - åˆ›å»ºæ•°æ®æº
- `testConnection()` - æµ‹è¯•è¿æ¥
- `activateDataSource()` - æ¿€æ´»æ•°æ®æº
- `loadDictionaries()` - åŠ è½½å­—å…¸è¡¨
- `mapValue()` - å­—å…¸å€¼æ˜ å°„

---

## ğŸ”Œ API ç«¯ç‚¹

### æŸ¥è¯¢ç›¸å…³
- `POST /api/query` - å‘é€æŸ¥è¯¢
- `GET /api/query/history` - è·å–æŸ¥è¯¢å†å²
- `DELETE /api/query/history` - æ¸…ç©ºå†å²

### ä¼šè¯ç›¸å…³
- `GET /api/sessions` - è·å–æ‰€æœ‰ä¼šè¯
- `POST /api/sessions` - åˆ›å»ºä¼šè¯
- `PUT /api/sessions/{id}` - æ›´æ–°ä¼šè¯
- `DELETE /api/sessions/{id}` - åˆ é™¤ä¼šè¯

### æ•°æ®æºç›¸å…³
- `GET /api/datasources` - è·å–æ•°æ®æºåˆ—è¡¨
- `POST /api/datasources` - åˆ›å»ºæ•°æ®æº
- `PUT /api/datasources/{id}` - æ›´æ–°æ•°æ®æº
- `DELETE /api/datasources/{id}` - åˆ é™¤æ•°æ®æº
- `POST /api/datasources/test` - æµ‹è¯•è¿æ¥
- `PUT /api/datasources/{id}/activate` - æ¿€æ´»æ•°æ®æº
- `POST /api/datasources/upload` - ä¸Šä¼  Excel

### æ•°æ®å‡†å¤‡ç›¸å…³
- `GET /api/data-prep/tables` - è·å–æ•°æ®è¡¨
- `POST /api/data-prep/tables/{id}/sync` - åŒæ­¥è¡¨ç»“æ„
- `GET /api/data-prep/dictionaries` - è·å–å­—å…¸è¡¨
- `POST /api/data-prep/dictionaries` - åˆ›å»ºå­—å…¸æ¡ç›®
- `PUT /api/data-prep/dictionaries/{id}` - æ›´æ–°å­—å…¸æ¡ç›®
- `DELETE /api/data-prep/dictionaries/{id}` - åˆ é™¤å­—å…¸æ¡ç›®

---

## ğŸ—„ï¸ æ•°æ®åº“è¡¨ç»“æ„

### users è¡¨
```sql
CREATE TABLE users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) NOT NULL UNIQUE,
    email VARCHAR(100) NOT NULL UNIQUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### data_sources è¡¨
```sql
CREATE TABLE data_sources (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    type ENUM('mysql', 'excel', 'api') NOT NULL,
    connection_string TEXT,
    file_path VARCHAR(255),
    is_active BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

### query_sessions è¡¨
```sql
CREATE TABLE query_sessions (
    id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL,
    session_id VARCHAR(100) NOT NULL,
    conversation JSON,
    last_active TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);
```

### query_history è¡¨
```sql
CREATE TABLE query_history (
    id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL,
    query_text TEXT NOT NULL,
    generated_sql TEXT,
    chart_type VARCHAR(50),
    result_data JSON,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);
```

### dictionary_table è¡¨
```sql
CREATE TABLE dictionary_table (
    id INT AUTO_INCREMENT PRIMARY KEY,
    table_name VARCHAR(100) NOT NULL,
    field_name VARCHAR(100) NOT NULL,
    value VARCHAR(100) NOT NULL,
    label VARCHAR(100) NOT NULL,
    description TEXT,
    is_active BOOLEAN DEFAULT TRUE,
    sort_order INT DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    UNIQUE KEY unique_entry (table_name, field_name, value)
);
```

---

## ğŸ”§ ç¯å¢ƒå˜é‡é…ç½®

åˆ›å»º `backend/.env` æ–‡ä»¶ï¼š

```env
# æ•°æ®åº“é…ç½®
DB_HOST=127.0.0.1
DB_PORT=3306
DB_USER=root
DB_PASSWORD=12345678
DB_NAME=chatbi
DB_POOL_SIZE=5

# æ¨¡å‹é…ç½®
MODEL_TYPE=local
QWEN_MODEL_NAME=qwen-agent

# åº”ç”¨é…ç½®
LOG_LEVEL=INFO
DEBUG=false
```

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
ChatBI/
â”œâ”€â”€ backend/                    # åç«¯æœåŠ¡
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ main.py            # åº”ç”¨å…¥å£
â”‚   â”‚   â”œâ”€â”€ config.py          # é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ api/               # API è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ services/          # ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ models/            # æ•°æ®æ¨¡å‹
â”‚   â”‚   â””â”€â”€ utils/             # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ tests/                 # æµ‹è¯•æ–‡ä»¶
â”‚   â”œâ”€â”€ .venv/                 # è™šæ‹Ÿç¯å¢ƒ
â”‚   â”œâ”€â”€ pyproject.toml         # é¡¹ç›®é…ç½®
â”‚   â””â”€â”€ .env                   # ç¯å¢ƒå˜é‡
â”‚
â”œâ”€â”€ frontend/                  # å‰ç«¯åº”ç”¨
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ App.vue            # æ ¹ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ main.ts            # å…¥å£æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ components/        # ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ views/             # é¡µé¢
â”‚   â”‚   â”œâ”€â”€ store/             # Pinia Store
â”‚   â”‚   â”œâ”€â”€ router/            # è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ utils/             # å·¥å…·å‡½æ•°
â”‚   â”‚   â””â”€â”€ styles/            # æ ·å¼
â”‚   â”œâ”€â”€ tests/                 # æµ‹è¯•æ–‡ä»¶
â”‚   â”œâ”€â”€ package.json           # ä¾èµ–é…ç½®
â”‚   â”œâ”€â”€ vite.config.ts         # Vite é…ç½®
â”‚   â””â”€â”€ vitest.config.ts       # Vitest é…ç½®
â”‚
â”œâ”€â”€ database/                  # æ•°æ®åº“
â”‚   â””â”€â”€ init.sql              # åˆå§‹åŒ–è„šæœ¬
â”‚
â”œâ”€â”€ scripts/                   # å¯åŠ¨è„šæœ¬
â”‚   â”œâ”€â”€ start.sh              # å¯åŠ¨è„šæœ¬
â”‚   â””â”€â”€ stop.sh               # åœæ­¢è„šæœ¬
â”‚
â”œâ”€â”€ .kiro/                     # Kiro é…ç½®
â”‚   â”œâ”€â”€ specs/                # é¡¹ç›®è§„èŒƒ
â”‚   â””â”€â”€ steering/             # å¼€å‘æŒ‡å—
â”‚
â”œâ”€â”€ README.md                  # é¡¹ç›®è¯´æ˜
â”œâ”€â”€ IFLOW.md                   # iFlow è¯´æ˜
â”œâ”€â”€ DEPLOYMENT.md              # éƒ¨ç½²æŒ‡å—
â””â”€â”€ PROJECT_OVERVIEW.md        # æœ¬æ–‡ä»¶
```

---

## ğŸ§ª æµ‹è¯•

### è¿è¡Œå‰ç«¯æµ‹è¯•
```bash
cd frontend
npm run test -- --run
```

### è¿è¡Œåç«¯æµ‹è¯•
```bash
cd backend
python -m pytest tests/
```

### è¿è¡Œé›†æˆæµ‹è¯•
```bash
cd backend
python -m pytest tests/integration/integration_test.py
```

---

## ğŸ“ å¸¸è§é—®é¢˜

### Q: å¯åŠ¨æ—¶æç¤º"è™šæ‹Ÿç¯å¢ƒä¸å­˜åœ¨"
A: è¿è¡Œä»¥ä¸‹å‘½ä»¤åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼š
```bash
cd backend
python3 -m venv .venv
source .venv/bin/activate
pip install -e .
```

### Q: æ•°æ®åº“è¿æ¥å¤±è´¥
A: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
1. MySQL æœåŠ¡æ˜¯å¦è¿è¡Œï¼š`brew services start mysql`
2. æ•°æ®åº“æ˜¯å¦åˆå§‹åŒ–ï¼š`mysql -u root < database/init.sql`
3. ç¯å¢ƒå˜é‡æ˜¯å¦æ­£ç¡®ï¼šæ£€æŸ¥ `backend/.env`

### Q: å‰ç«¯æ— æ³•è®¿é—®åç«¯ API
A: æ£€æŸ¥ `frontend/vite.config.ts` ä¸­çš„ä»£ç†é…ç½®æ˜¯å¦æ­£ç¡®æŒ‡å‘ `http://localhost:8000`

### Q: æŸ¥è¯¢è¿”å›æƒé™é”™è¯¯
A: æ£€æŸ¥ç”¨æˆ·æƒé™é…ç½®ï¼š
1. æ‰“å¼€å³ä¾§é…ç½®æŠ½å±‰
2. ç‚¹å‡»"æƒé™é…ç½®"
3. ç¡®ä¿ç”¨æˆ·æœ‰æƒè®¿é—®è¯¥è¡¨

---

## ğŸ¯ ä¸‹ä¸€æ­¥

1. **éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ** - å‚è€ƒ `DEPLOYMENT.md`
2. **é›†æˆ Qwen æ¨¡å‹** - é…ç½® `MODEL_TYPE=cloud` å’Œ `QWEN_API_KEY`
3. **æ·»åŠ æ›´å¤šæ•°æ®æº** - æ”¯æŒ PostgreSQLã€Oracle ç­‰
4. **æ€§èƒ½ä¼˜åŒ–** - å¯ç”¨ Redis ç¼“å­˜ã€æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–
5. **ç”¨æˆ·è®¤è¯** - é›†æˆ OAuth æˆ– JWT è®¤è¯

---

**æœ€åæ›´æ–°**: 2026-01-16  
**ç‰ˆæœ¬**: 1.0  
**çŠ¶æ€**: ç”Ÿäº§å°±ç»ª âœ…
