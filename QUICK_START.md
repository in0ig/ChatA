# ChatBI 快速启动指南

## ⚡ 30秒快速启动

```bash
# 1. 进入项目目录
cd /path/to/ChatBI

# 2. 一键启动所有服务
./scripts/start.sh

# 3. 打开浏览器访问
# 前端: http://localhost:3000
# API文档: http://localhost:8000/docs
```

## 🛑 停止服务

```bash
./scripts/stop.sh
```

## 🔍 实时查看日志

```bash
# 后端详细日志
tail -f backend/backend/backend.log

# 启动脚本输出日志
tail -f backend.log
tail -f frontend.log
```

---

## 📱 首次使用步骤

### 1️⃣ 创建数据源
- 点击左侧导航 → 数据分析 → 数据源
- 点击"新建连接"
- 填写数据库连接信息
- 点击"测试连接"验证
- 点击"保存"

### 2️⃣ 开始提问
- 返回对话工作台
- 在输入框输入问题（如："2024年销售额是多少？"）
- 点击发送按钮
- 查看 AI 回复和图表

### 3️⃣ 切换模式
- 在输入框上方找到"模式切换"开关
- 在"智能问数"和"生成报告"之间切换
- 继续提问

### 4️⃣ 管理权限
- 点击右上角"配置"按钮
- 打开右侧配置抽屉
- 点击"权限配置"
- 配置功能权限和数据表权限

---

## 🔧 故障排查

### 问题：启动脚本提示"虚拟环境不存在"

**解决方案**：
```bash
cd backend
python3 -m venv .venv
source .venv/bin/activate
pip install -e .
```

### 问题：数据库连接失败

**解决方案**：
```bash
# 1. 启动 MySQL
brew services start mysql

# 2. 初始化数据库
mysql -u root < database/init.sql

# 3. 检查环境变量
cat backend/.env
```

### 问题：端口被占用

**解决方案**：
```bash
# 查找占用端口的进程
lsof -i :8000  # 后端
lsof -i :3000  # 前端

# 终止进程
kill -9 <PID>
```

### 问题：前端无法访问后端

**解决方案**：
- 检查后端是否运行：访问 http://localhost:8000/docs
- 检查前端代理配置：`frontend/vite.config.ts`
- 检查浏览器控制台错误信息

---

## 📊 核心概念

### 会话（Session）
- 用户与 AI 的一次完整对话
- 支持多轮问答和上下文记忆
- 自动保存到数据库

### 数据源（DataSource）
- 数据的来源（MySQL 或 Excel）
- 支持多个数据源
- 同一时间只能激活一个

### 查询模式（ChatMode）
- **智能问数**：快速查询数据
- **生成报告**：生成结构化分析报告

### 查询缓存（QueryCache）
- 自动缓存查询结果
- 相同查询直接返回缓存（无需调用后端）
- 提升响应速度

### 权限控制（Permissions）
- 功能权限：查询、报告、导出
- 数据表权限：行级和列级权限

---

## 🎯 常用操作

### 创建新会话
```
点击左侧"新建会话" → 系统创建新会话 → 开始提问
```

### 切换会话
```
点击左侧会话列表 → 选择要切换的会话 → 查看该会话的消息
```

### 删除会话
```
右键点击会话 → 选择"删除" → 确认删除
```

### 查看查询历史
```
点击"历史"按钮 → 查看历史查询列表 → 点击项目重新加载结果
```

### 清空历史
```
点击"清空历史"按钮 → 确认清空 → 历史记录被删除
```

### 导出结果
```
点击结果右上角"导出"按钮 → 选择格式（CSV/Excel/PDF） → 下载文件
```

---

## 🔐 权限配置

### 功能权限
- **查询**：允许用户发送查询
- **报告**：允许用户生成报告
- **导出**：允许用户导出结果

### 数据表权限
- 选择用户可以访问的表
- 未选中的表无法查询
- 支持行级和列级权限

---

## 📈 性能优化建议

### 前端优化
- 启用查询缓存（自动）
- 使用防抖/节流减少请求
- 组件懒加载

### 后端优化
- 数据库连接池（已配置）
- 查询结果缓存
- 多进程处理

### 数据库优化
- 创建适当的索引
- 定期维护表结构
- 监控查询性能

---

## 📞 获取帮助

### 查看 API 文档
访问 http://localhost:8000/docs

### 查看项目文档
- `README.md` - 项目说明
- `DEPLOYMENT.md` - 部署指南
- `PROJECT_OVERVIEW.md` - 完整指南
- `IFLOW.md` - 开发指南

### 查看日志
```bash
# 后端详细日志（推荐）
tail -f backend/backend/backend.log

# 启动脚本输出
tail -f backend.log
tail -f frontend.log
```

### 前端调试
1. 打开浏览器开发者工具 (F12)
2. Console 标签查看日志
3. Network 标签查看 API 请求
4. Application > Local Storage 查看持久化日志

---

**提示**: 更多详细信息请参考 `PROJECT_OVERVIEW.md` 和 `README.md`
