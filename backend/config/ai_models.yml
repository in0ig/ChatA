# AI模型配置文件
# 支持云端Qwen模型和本地OpenAI模型

# 云端Qwen模型配置
qwen_cloud:
  api_key: "${DASHSCOPE_API_KEY:-sk-399d0eb35c494883afdc3ca41e2ce214}"  # 从环境变量获取
  base_url: "${ALIYUN_API_URL:-https://dashscope.aliyuncs.com/api/v1}"
  model_name: "${DASHSCOPE_MODEL:-qwen-plus-2025-09-11}"
  max_tokens: 2000
  temperature: 0.1  # 较低的温度确保SQL生成的一致性
  retry_count: 3
  retry_delay: 1.0
  
  # Token使用量监控配置
  cost_tracking:
    enabled: true
    cost_per_1k_tokens: 0.002  # $0.002 per 1K tokens
    daily_limit_tokens: 100000  # 每日Token使用限制
    alert_threshold: 0.8  # 达到80%时发出警告

# 本地OpenAI模型配置（暂时使用阿里云Qwen模型）
openai_local:
  # 暂时使用阿里云Qwen模型的配置，后续会替换为真正的本地模型
  api_key: "${DASHSCOPE_API_KEY:-sk-399d0eb35c494883afdc3ca41e2ce214}"
  base_url: "${ALIYUN_API_URL:-https://dashscope.aliyuncs.com/api/v1}"
  model_name: "${DASHSCOPE_MODEL:-qwen-plus-2025-09-11}"
  max_tokens: 2000
  temperature: 0.7  # 较高的温度用于数据分析的创造性
  retry_count: 2
  retry_delay: 0.5
  
  # 性能优化配置
  performance:
    max_concurrent_requests: 5
    request_timeout: 60
    keep_alive: true
  
  # 数据隐私保护配置（即使暂时使用云端API，也要有隐私保护意识）
  privacy:
    network_isolation_check: true  # 检查网络隔离（暂时跳过）
    audit_logging: true  # 审计日志
    data_retention_days: 0  # 不保留数据

# 模型选择策略
model_selection:
  # SQL生成使用云端Qwen模型
  sql_generation:
    primary: "qwen_cloud"
    fallback: null  # 不使用备用模型，确保数据安全
  
  # 数据分析使用本地OpenAI模型
  data_analysis:
    primary: "openai_local"
    fallback: null  # 不使用备用模型，确保数据隐私
  
  # 意图识别使用云端Qwen模型
  intent_recognition:
    primary: "qwen_cloud"
    fallback: null

# 数据安全配置
security:
  # 云端模型数据清洗规则
  cloud_data_sanitization:
    enabled: true
    # 禁止发送的数据模式
    blocked_patterns:
      - "\\b\\d{4}-\\d{2}-\\d{2}\\b"  # 日期格式
      - "\\b\\d+\\.\\d+\\b"  # 数值
      - "'[^']*'"  # 字符串值
      - '"[^"]*"'  # 双引号字符串值
      - "\\b\\d{11,}\\b"  # 长数字（可能是ID或手机号）
    
    # 允许的元数据类型
    allowed_metadata:
      - "table_names"
      - "column_names"
      - "data_types"
      - "constraints"
      - "relationships"
  
  # 本地模型数据处理
  local_data_processing:
    enabled: true
    # 确保数据不出网的检查
    network_isolation_check: true
    # 数据处理日志
    audit_logging: true

# 监控和日志配置
monitoring:
  # 性能监控
  performance_metrics:
    enabled: true
    response_time_threshold: 10.0  # 秒
    error_rate_threshold: 0.05  # 5%
  
  # Token使用量监控
  token_usage_monitoring:
    enabled: true
    daily_report: true
    cost_alerts: true
  
  # 日志配置
  logging:
    level: "INFO"
    include_prompts: false  # 不记录完整prompt以保护隐私
    include_responses: false  # 不记录完整响应以保护隐私
    include_metadata: true  # 记录元数据用于监控