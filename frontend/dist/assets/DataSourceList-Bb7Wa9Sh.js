import{e as H,c as i,l as a,j as h,i as l,a as s,h as R,m as d,R as U,S as Z,k,t as u,v,U as q,V as J,x as j,W as ee,X as te,Y as ae,o as c,_ as K,f as E,g as V,w as ne,M as oe,B as se,Z as le,y as ce,L as S,$ as ie}from"./index-UzuFSHw5.js";import{u as re}from"./dataPreparation-DG379VK_.js";const de={class:"data-source-table"},ue={class:"name-cell"},pe={class:"source-icon"},_e={class:"name-content"},me={class:"name-text"},fe={key:0,class:"description-text"},he={key:0},ge={key:1,class:"text-muted"},ve={class:"connection-info"},ye={key:0},Se={key:0},Te={key:1,class:"db-name"},Ce={key:1},be={key:0},Ee={key:2,class:"text-muted"},De={key:0,class:"is-loading"},ke={class:"action-buttons"},Ae=H({__name:"DataSourceTable",props:{data:{},loading:{type:Boolean,default:!1}},emits:["edit","delete","testConnection","sortChange"],setup(O,{emit:r}){const p=r,T=o=>({DATABASE:"数据库",FILE:"文件"})[o]||o,C=o=>({DATABASE:"primary",FILE:"success"})[o]||"info",_=o=>({MYSQL:"MySQL",SQLSERVER:"SQL Server",POSTGRESQL:"PostgreSQL",CLICKHOUSE:"ClickHouse"})[o]||o,b=o=>({CONNECTED:"已连接",DISCONNECTED:"未连接",FAILED:"连接失败",TESTING:"测试中"})[o]||o,D=o=>({CONNECTED:"success",DISCONNECTED:"info",FAILED:"danger",TESTING:"warning"})[o]||"info",A=o=>o.split("/").pop()||o,$=o=>new Date(o).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),G=o=>{p("edit",o)},L=o=>{p("delete",o)},F=o=>{p("testConnection",o)},B=({prop:o,order:g})=>{p("sortChange",{prop:o,order:g})};return(o,g)=>{const m=h("el-table-column"),z=h("el-tag"),N=h("el-button"),x=h("el-tooltip"),Q=h("el-table");return c(),i("div",de,[a(Q,{data:O.data,loading:O.loading,stripe:"",border:"",onSortChange:B,class:"source-table","empty-text":"暂无数据源"},{default:l(()=>[a(m,{prop:"name",label:"数据源名称",sortable:"custom","min-width":"180","show-overflow-tooltip":""},{default:l(({row:e})=>[s("div",ue,[s("el-icon",pe,[e.sourceType==="DATABASE"?(c(),R(d(U),{key:0})):(c(),R(d(Z),{key:1}))]),s("div",_e,[s("div",me,u(e.name),1),e.description?(c(),i("div",fe,u(e.description),1)):k("",!0)])])]),_:1}),a(m,{prop:"sourceType",label:"类型",sortable:"custom",width:"120",align:"center"},{default:l(({row:e})=>[a(z,{type:C(e.sourceType),size:"small"},{default:l(()=>[v(u(T(e.sourceType)),1)]),_:2},1032,["type"])]),_:1}),a(m,{prop:"dbType",label:"数据库类型",width:"120",align:"center"},{default:l(({row:e})=>[e.sourceType==="DATABASE"&&e.dbType?(c(),i("span",he,u(_(e.dbType)),1)):(c(),i("span",ge,"-"))]),_:1}),a(m,{label:"连接信息","min-width":"200","show-overflow-tooltip":""},{default:l(({row:e})=>[s("div",ve,[e.sourceType==="DATABASE"?(c(),i("div",ye,[e.host?(c(),i("div",Se,[s("el-icon",null,[a(d(q))]),v(" "+u(e.host)+u(e.port?":"+e.port:""),1)])):k("",!0),e.databaseName?(c(),i("div",Te,[s("el-icon",null,[a(d(U))]),v(" "+u(e.databaseName),1)])):k("",!0)])):e.sourceType==="FILE"?(c(),i("div",Ce,[e.filePath?(c(),i("div",be,[s("el-icon",null,[a(d(J))]),v(" "+u(A(e.filePath)),1)])):k("",!0)])):(c(),i("span",Ee,"-"))])]),_:1}),a(m,{prop:"connectionStatus",label:"连接状态",sortable:"custom",width:"120",align:"center"},{default:l(({row:e})=>[a(z,{type:D(e.connectionStatus),size:"small",effect:e.connectionStatus==="TESTING"?"plain":"dark"},{default:l(()=>[e.connectionStatus==="TESTING"?(c(),i("el-icon",De,[a(d(j))])):k("",!0),v(" "+u(b(e.connectionStatus)),1)]),_:2},1032,["type","effect"])]),_:1}),a(m,{prop:"createdAt",label:"创建时间",sortable:"custom",width:"160",align:"center"},{default:l(({row:e})=>[v(u($(e.createdAt)),1)]),_:1}),a(m,{prop:"updatedAt",label:"更新时间",sortable:"custom",width:"160",align:"center"},{default:l(({row:e})=>[v(u($(e.updatedAt)),1)]),_:1}),a(m,{label:"操作",width:"200",align:"center",fixed:"right"},{default:l(({row:e})=>[s("div",ke,[a(x,{content:"测试连接",placement:"top"},{default:l(()=>[a(N,{type:"primary",size:"small",icon:d(ee),circle:"",onClick:w=>F(e),loading:e.connectionStatus==="TESTING"},null,8,["icon","onClick","loading"])]),_:2},1024),a(x,{content:"编辑",placement:"top"},{default:l(()=>[a(N,{type:"warning",size:"small",icon:d(te),circle:"",onClick:w=>G(e)},null,8,["icon","onClick"])]),_:2},1024),a(x,{content:"删除",placement:"top"},{default:l(()=>[a(N,{type:"danger",size:"small",icon:d(ae),circle:"",onClick:w=>L(e)},null,8,["icon","onClick"])]),_:2},1024)])]),_:1})]),_:1},8,["data","loading"])])}}}),Le=K(Ae,[["__scopeId","data-v-e60148e7"]]),Ne={class:"data-source-list"},xe={class:"page-header"},Ie={class:"header-right"},Ve={class:"filter-section"},$e={class:"filter-row"},Fe={class:"filter-item"},Be={class:"filter-item"},ze={class:"filter-item"},we={class:"filter-item"},Me={class:"table-section"},Oe={key:0,class:"pagination-section"},Ge=H({__name:"DataSourceList",setup(O){const r=re(),p=E(""),T=E(""),C=E(""),_=E(1),b=E(20),D=E(""),A=E(""),$=V(()=>r.dataSourceLoading),G=V(()=>r.dataSourcesData),L=V(()=>{let n=[...G.value];if(p.value){const t=p.value.toLowerCase();n=n.filter(y=>y.name.toLowerCase().includes(t)||y.description&&y.description.toLowerCase().includes(t))}return T.value&&(n=n.filter(t=>t.sourceType===T.value)),C.value&&(n=n.filter(t=>t.connectionStatus===C.value)),D.value&&A.value&&n.sort((t,y)=>{const M=B(t,D.value),f=B(y,D.value);return A.value==="ascending"?M>f?1:-1:M<f?1:-1}),n}),F=V(()=>L.value.length);V(()=>{const n=(_.value-1)*b.value,t=n+b.value;return L.value.slice(n,t)});const B=(n,t)=>{switch(t){case"name":return n.name;case"sourceType":return n.sourceType;case"connectionStatus":return n.connectionStatus;case"createdAt":return new Date(n.createdAt).getTime();case"updatedAt":return new Date(n.updatedAt).getTime();default:return""}},o=()=>{_.value=1},g=()=>{_.value=1},m=()=>{_.value=1},z=async()=>{try{await r.fetchDataSources(),S.success("数据源列表已刷新")}catch{S.error("刷新失败，请重试")}},N=()=>{r.toggleModal("dataSourceForm",!0),r.setModalMode("dataSourceForm","create")},x=n=>{r.toggleModal("dataSourceForm",!0,n),r.setModalMode("dataSourceForm","edit")},Q=async n=>{try{await ie.confirm(`确定要删除数据源 "${n.name}" 吗？此操作不可恢复。`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const t=await r.deleteDataSource(n.id);t.success?S.success("数据源删除成功"):S.error(t.message||"删除失败")}catch{}},e=async n=>{try{S.info("正在测试连接...");const t=await r.testConnection(n);t.success&&t.data?.success?S.success("连接测试成功"):S.error(t.data?.message||"连接测试失败")}catch{S.error("连接测试失败")}},w=({prop:n,order:t})=>{D.value=n,A.value=t},Y=n=>{b.value=n,_.value=1},W=n=>{_.value=n};return ne([p,T,C],()=>{_.value=1}),oe(async()=>{await r.fetchDataSources()}),(n,t)=>{const y=h("el-button"),M=h("el-input"),f=h("el-option"),P=h("el-select"),X=h("el-pagination");return c(),i("div",Ne,[s("div",xe,[t[4]||(t[4]=s("div",{class:"header-left"},[s("h2",{class:"page-title"},"数据源管理"),s("p",{class:"page-description"},"管理和配置数据源连接")],-1)),s("div",Ie,[a(y,{type:"primary",icon:d(se),onClick:N},{default:l(()=>[...t[3]||(t[3]=[v(" 新建数据源 ",-1)])]),_:1},8,["icon"])])]),s("div",Ve,[s("div",$e,[s("div",Fe,[a(M,{modelValue:p.value,"onUpdate:modelValue":t[0]||(t[0]=I=>p.value=I),placeholder:"搜索数据源名称","prefix-icon":d(le),clearable:"",onInput:o,class:"search-input"},null,8,["modelValue","prefix-icon"])]),s("div",Be,[a(P,{modelValue:T.value,"onUpdate:modelValue":t[1]||(t[1]=I=>T.value=I),placeholder:"选择数据源类型",clearable:"",onChange:g,class:"type-filter"},{default:l(()=>[a(f,{label:"全部类型",value:""}),a(f,{label:"数据库",value:"DATABASE"}),a(f,{label:"文件",value:"FILE"})]),_:1},8,["modelValue"])]),s("div",ze,[a(P,{modelValue:C.value,"onUpdate:modelValue":t[2]||(t[2]=I=>C.value=I),placeholder:"选择连接状态",clearable:"",onChange:m,class:"status-filter"},{default:l(()=>[a(f,{label:"全部状态",value:""}),a(f,{label:"已连接",value:"CONNECTED"}),a(f,{label:"未连接",value:"DISCONNECTED"}),a(f,{label:"连接失败",value:"FAILED"})]),_:1},8,["modelValue"])]),s("div",we,[a(y,{onClick:z,icon:d(ce)},{default:l(()=>[...t[5]||(t[5]=[v(" 刷新 ",-1)])]),_:1},8,["icon"])])])]),s("div",Me,[a(Le,{data:L.value,loading:$.value,onEdit:x,onDelete:Q,onTestConnection:e,onSortChange:w},null,8,["data","loading"])]),F.value>b.value?(c(),i("div",Oe,[a(X,{"current-page":_.value,"page-size":b.value,"page-sizes":[10,20,50,100],total:F.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:Y,onCurrentChange:W},null,8,["current-page","page-size","total"])])):k("",!0)])}}}),Re=K(Ge,[["__scopeId","data-v-714277bc"]]);export{Re as default};
