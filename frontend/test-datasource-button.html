<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>数据源按钮测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            max-width: 800px;
            margin: 0 auto;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
        }
        .test-title {
            color: #333;
            margin-bottom: 15px;
            font-size: 18px;
            font-weight: bold;
        }
        .test-button {
            background: #409eff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
        }
        .test-button:hover {
            background: #337ecc;
        }
        .test-result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            font-weight: bold;
        }
        .success {
            background: #f0f9ff;
            color: #1890ff;
            border: 1px solid #b3d8ff;
        }
        .error {
            background: #fff2f0;
            color: #ff4d4f;
            border: 1px solid #ffccc7;
        }
        .info {
            background: #f6ffed;
            color: #52c41a;
            border: 1px solid #b7eb8f;
        }
        iframe {
            width: 100%;
            height: 600px;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>数据源管理按钮测试</h1>
        
        <div class="test-section">
            <div class="test-title">1. 基础按钮点击测试</div>
            <button class="test-button" onclick="testBasicClick()">测试基础点击</button>
            <button class="test-button" onclick="testDialogToggle()">测试对话框切换</button>
            <div id="basic-result" class="test-result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <div class="test-title">2. Vue 响应式测试</div>
            <button class="test-button" onclick="testVueReactivity()">测试 Vue 响应式</button>
            <div id="vue-result" class="test-result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <div class="test-title">3. 访问数据源管理页面</div>
            <button class="test-button" onclick="openDataSourcePage()">打开数据源管理页面</button>
            <button class="test-button" onclick="testInIframe()">在 iframe 中测试</button>
            <div id="page-result" class="test-result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <div class="test-title">4. 页面预览</div>
            <iframe id="preview-frame" src="about:blank"></iframe>
        </div>
    </div>

    <script>
        function showResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `test-result ${type}`;
            element.style.display = 'block';
        }

        function testBasicClick() {
            let clickCount = 0;
            const button = document.createElement('button');
            button.textContent = '点击我';
            button.onclick = () => {
                clickCount++;
                showResult('basic-result', `按钮被点击了 ${clickCount} 次`, 'success');
            };
            
            // 模拟点击
            button.click();
        }

        function testDialogToggle() {
            let dialogVisible = false;
            
            function toggleDialog() {
                dialogVisible = !dialogVisible;
                showResult('basic-result', 
                    `对话框状态: ${dialogVisible ? '显示' : '隐藏'}`, 
                    dialogVisible ? 'success' : 'info'
                );
            }
            
            // 模拟切换
            toggleDialog();
            setTimeout(() => toggleDialog(), 1000);
        }

        function testVueReactivity() {
            // 模拟 Vue 响应式行为
            const state = {
                showAddDialog: false
            };
            
            const handler = {
                set(target, property, value) {
                    target[property] = value;
                    showResult('vue-result', 
                        `${property} 已更新为: ${value}`, 
                        'success'
                    );
                    return true;
                }
            };
            
            const reactiveState = new Proxy(state, handler);
            
            // 模拟按钮点击
            reactiveState.showAddDialog = true;
        }

        function openDataSourcePage() {
            try {
                const url = 'http://localhost:5173/chatbi/datasources';
                window.open(url, '_blank');
                showResult('page-result', '已在新窗口打开数据源管理页面', 'success');
            } catch (error) {
                showResult('page-result', `打开页面失败: ${error.message}`, 'error');
            }
        }

        function testInIframe() {
            try {
                const iframe = document.getElementById('preview-frame');
                iframe.src = 'http://localhost:5173/chatbi/datasources';
                showResult('page-result', '正在 iframe 中加载数据源管理页面...', 'info');
                
                iframe.onload = () => {
                    showResult('page-result', 'iframe 加载完成，请检查按钮功能', 'success');
                };
                
                iframe.onerror = () => {
                    showResult('page-result', 'iframe 加载失败，请检查开发服务器是否运行', 'error');
                };
            } catch (error) {
                showResult('page-result', `iframe 测试失败: ${error.message}`, 'error');
            }
        }

        // 页面加载完成后的初始化
        window.onload = () => {
            showResult('page-result', '测试页面已加载，点击按钮开始测试', 'info');
        };
    </script>
</body>
</html>