# 任务 6.5.2 - 智能图表系统测试指南

## 📋 测试概述

本文档提供智能图表系统的完整测试指南，包括自动化测试和手动测试场景。

### 测试目标

- ✅ 验证 SmartChart 组件各种图表类型渲染
- ✅ 验证图表类型智能识别准确性
- ✅ 验证图表交互功能（缩放、平移、选择、钻取、联动）
- ✅ 验证图表导出和分享功能
- ✅ 验证大数据量性能处理能力
- ✅ 验证图表主题和动画效果
- ✅ 验证图表流式渲染功能

### 测试环境要求

**后端服务**:
- Python 3.9+
- FastAPI 服务运行在 `http://localhost:8000`
- MySQL 数据库连接正常
- 真实数据表已创建并包含测试数据

**前端服务**:
- Node.js 16+
- Vue 3 + Vite 开发服务器运行在 `http://localhost:5173`
- ECharts 5.x 已安装
- Element Plus 已安装

**浏览器**:
- Chrome/Edge 最新版本（用于 Playwright 测试）
- 支持 WebGL（用于复杂图表渲染）

---

## 🚀 快速开始

### 1. 环境准备

```bash
# 1. 启动后端服务
cd backend
source .venv/bin/activate  # Windows: .venv\Scripts\activate
uvicorn src.main:app --reload

# 2. 启动前端服务（新终端）
cd frontend
npm run dev

# 3. 验证服务状态
# 后端: http://localhost:8000/docs
# 前端: http://localhost:5173
```

### 2. 运行自动化测试

```bash
# 运行后端测试
cd backend
pytest tests/e2e/test_real_smart_chart_system.py -v -s

# 运行前端测试
cd frontend
npx playwright test tests/e2e/smart-chart-system-real.spec.ts --headed

# 查看测试报告
npx playwright show-report
```

---

## 📊 自动化测试场景

### 后端测试（10个场景）

1. **柱状图渲染测试** - 验证柱状图数据结构和渲染
2. **折线图渲染测试** - 验证时间序列数据和折线图渲染
3. **饼图渲染测试** - 验证占比数据和饼图渲染
4. **散点图渲染测试** - 验证二维数值数据和散点图渲染
5. **图表类型智能识别测试** - 验证AI识别准确率 > 85%
6. **图表交互功能测试** - 验证缩放、选择、图例等交互
7. **图表导出和分享测试** - 验证多格式导出和分享链接
8. **大数据量性能测试** - 验证1000+/5000+/10000+数据点处理
9. **图表主题和动画测试** - 验证6套主题和6种动画预设
10. **图表流式渲染测试** - 验证流式渲染和增量更新

### 前端测试（12个场景）

1. **柱状图渲染测试** - UI渲染和交互验证
2. **折线图渲染测试** - 时间序列图表UI验证
3. **饼图渲染测试** - 占比图表UI验证
4. **图表类型智能识别测试** - 自动识别和推荐验证
5. **图表交互功能测试** - 类型切换、缩放、工具栏验证
6. **图表导出功能测试** - 导出菜单和选项验证
7. **图表分享功能测试** - 分享对话框和选项验证
8. **大数据量性能测试** - 渲染时间和响应性验证
9. **图表主题切换测试** - 主题切换UI验证
10. **响应式设计测试** - 桌面/平板/手机适配验证
11. **图表配置保存测试** - 配置保存和模板功能验证
12. **图表错误处理测试** - 错误提示和恢复验证

---


## 🧪 手动测试场景

### 场景 1: 各种图表类型渲染测试

**测试目的**: 验证 SmartChart 组件支持的所有图表类型能够正确渲染

**测试步骤**:

1. 打开浏览器访问 `http://localhost:5173/chat`
2. 输入问题："显示各产品的销量对比"
3. 点击"发送"按钮
4. 等待图表渲染完成

**验证点**:
- ✅ 图表容器正确显示
- ✅ 默认渲染为柱状图
- ✅ 图表工具栏显示
- ✅ 图表类型切换按钮可见
- ✅ 数据正确展示在图表中

**测试图表类型**:
- 柱状图：分类数据对比
- 折线图：时间序列趋势
- 饼图：占比分布
- 散点图：相关性分析
- 热力图：二维分布
- 雷达图：多维度对比

**预期结果**: 所有图表类型都能正确渲染，数据展示准确

**截图保存**: `test-results/manual-chart-types.png`

---

### 场景 2: 图表类型智能识别测试

**测试目的**: 验证系统能够根据数据特征和用户问题智能推荐图表类型

**测试步骤**:

1. 测试时间序列识别
   - 输入："显示最近30天的销售趋势"
   - 验证：应推荐折线图

2. 测试占比识别
   - 输入："各产品的销售额占比"
   - 验证：应推荐饼图

3. 测试对比识别
   - 输入："对比各区域的销量"
   - 验证：应推荐柱状图

4. 测试相关性识别
   - 输入："广告投入和销售额的关系"
   - 验证：应推荐散点图

**验证点**:
- ✅ 图表推荐提示框显示
- ✅ 推荐理由清晰明确
- ✅ 推荐的图表类型按钮高亮
- ✅ 识别准确率 > 85%

**预期结果**: 系统能够智能识别并推荐合适的图表类型

**截图保存**: `test-results/manual-chart-recognition.png`

---

### 场景 3: 图表交互功能测试

**测试目的**: 验证图表的各种交互功能正常工作

**测试步骤**:

1. **测试图表类型切换**
   - 点击工具栏中的不同图表类型按钮
   - 验证图表能够平滑切换

2. **测试缩放功能**
   - 使用鼠标滚轮在图表上缩放
   - 拖动数据缩放滑块
   - 验证图表能够正确缩放

3. **测试数据点悬停**
   - 将鼠标悬停在数据点上
   - 验证显示详细信息的 tooltip

4. **测试图例交互**
   - 点击图例项
   - 验证对应数据系列显示/隐藏

5. **测试工具栏功能**
   - 点击"区域缩放"工具
   - 点击"还原"工具
   - 验证功能正常

**验证点**:
- ✅ 图表类型切换流畅
- ✅ 缩放功能响应及时
- ✅ Tooltip 显示准确
- ✅ 图例交互正常
- ✅ 工具栏功能完整

**预期结果**: 所有交互功能正常，用户体验流畅

**截图保存**: `test-results/manual-chart-interaction.png`

---

### 场景 4: 图表导出功能测试

**测试目的**: 验证图表能够导出为多种格式

**测试步骤**:

1. 渲染一个图表
2. 点击工具栏中的"导出"按钮
3. 验证导出菜单显示

4. **测试PNG导出**
   - 选择"PNG图片"
   - 验证下载文件

5. **测试JPG导出**
   - 选择"JPG图片"
   - 验证下载文件

6. **测试PDF导出**
   - 选择"PDF文档"
   - 验证下载文件

7. **测试SVG导出**
   - 选择"SVG矢量图"
   - 验证下载文件

8. **测试Excel导出**
   - 选择"Excel数据"
   - 验证下载文件包含原始数据

**验证点**:
- ✅ 导出菜单显示完整
- ✅ 支持5种导出格式
- ✅ 导出文件能够正常打开
- ✅ 导出内容准确完整
- ✅ 文件命名合理

**预期结果**: 所有导出格式都能正常工作，文件质量良好

**截图保存**: `test-results/manual-chart-export.png`

---

### 场景 5: 图表分享功能测试

**测试目的**: 验证图表能够生成分享链接和嵌入代码

**测试步骤**:

1. 渲染一个图表
2. 点击工具栏中的"分享"按钮
3. 验证分享对话框显示

4. **测试分享链接**
   - 切换到"分享链接"选项卡
   - 设置有效期（7天/30天/永久）
   - 点击"生成"按钮
   - 验证分享链接生成
   - 点击"复制"按钮
   - 验证链接已复制到剪贴板

5. **测试嵌入代码**
   - 切换到"嵌入代码"选项卡
   - 点击"生成"按钮
   - 验证嵌入代码生成
   - 点击"复制代码"按钮
   - 验证代码已复制到剪贴板

**验证点**:
- ✅ 分享对话框显示正常
- ✅ 分享链接格式正确
- ✅ 嵌入代码格式正确
- ✅ 有效期设置生效
- ✅ 复制功能正常

**预期结果**: 分享功能完整，链接和代码可用

**截图保存**: `test-results/manual-chart-share.png`

---

### 场景 6: 大数据量性能测试

**测试目的**: 验证图表能够处理大数据量并保持良好性能

**测试步骤**:

1. **测试1000数据点**
   - 输入查询返回1000行数据
   - 记录渲染时间
   - 验证图表交互流畅

2. **测试5000数据点**
   - 输入查询返回5000行数据
   - 验证是否启用性能优化
   - 检查优化提示消息
   - 验证图表仍可交互

3. **测试10000数据点**
   - 输入查询返回10000行数据
   - 验证是否启用流式渲染
   - 观察加载进度显示
   - 验证最终渲染结果

**验证点**:
- ✅ 1000数据点渲染时间 < 1秒
- ✅ 5000数据点渲染时间 < 2秒
- ✅ 10000数据点渲染时间 < 3秒
- ✅ 大数据量时显示优化提示
- ✅ 图表交互保持流畅
- ✅ 内存使用合理

**性能指标**:
- 渲染时间: < 3秒
- 交互响应: < 100ms
- 内存增长: < 200MB

**预期结果**: 大数据量处理高效，性能优化生效

**截图保存**: `test-results/manual-chart-performance.png`

---

### 场景 7: 图表主题和动画测试

**测试目的**: 验证图表支持多套主题和动画效果

**测试步骤**:

1. **测试主题切换**（如果支持）
   - 渲染一个图表
   - 切换到深色主题
   - 验证图表颜色变化
   - 切换到商务主题
   - 验证图表样式变化

2. **测试动画效果**
   - 观察图表初始渲染动画
   - 切换图表类型观察过渡动画
   - 更新数据观察更新动画

**验证点**:
- ✅ 支持多套主题（浅色、深色、商务、科技等）
- ✅ 主题切换流畅
- ✅ 颜色搭配合理
- ✅ 动画效果自然
- ✅ 动画时长适中（约1秒）

**预期结果**: 主题丰富，动画流畅自然

**截图保存**: 
- `test-results/manual-chart-theme-light.png`
- `test-results/manual-chart-theme-dark.png`

---

### 场景 8: 响应式设计测试

**测试目的**: 验证图表在不同设备上的显示效果

**测试步骤**:

1. **桌面端测试** (1920x1080)
   - 打开浏览器全屏
   - 渲染图表
   - 验证布局合理

2. **平板端测试** (768x1024)
   - 使用浏览器开发者工具
   - 切换到iPad视图
   - 验证图表自适应

3. **手机端测试** (375x667)
   - 切换到iPhone视图
   - 验证图表在小屏幕上的显示
   - 测试触摸交互

**验证点**:
- ✅ 图表容器自适应屏幕宽度
- ✅ 图表高度合理
- ✅ 工具栏在小屏幕上可用
- ✅ 触摸交互正常
- ✅ 文字大小适中

**预期结果**: 在各种设备上都有良好的显示效果

**截图保存**: 
- `test-results/manual-chart-desktop.png`
- `test-results/manual-chart-tablet.png`
- `test-results/manual-chart-mobile.png`

---


## 📈 性能测试

### 性能指标要求

| 指标 | 目标值 | 测试方法 |
|------|--------|----------|
| 1000数据点渲染时间 | < 1秒 | 计时测试 |
| 5000数据点渲染时间 | < 2秒 | 计时测试 |
| 10000数据点渲染时间 | < 3秒 | 计时测试 |
| 图表交互响应时间 | < 100ms | 用户操作计时 |
| 内存使用增长 | < 200MB | 浏览器性能监控 |
| 图表类型切换时间 | < 500ms | 计时测试 |

### 性能测试步骤

1. 打开浏览器开发者工具（F12）
2. 切换到 Performance 标签
3. 点击录制按钮
4. 执行测试操作
5. 停止录制
6. 分析性能报告

---

## 🔍 测试报告模板

### 测试执行记录表

| 测试场景 | 执行时间 | 测试结果 | 问题描述 | 截图路径 |
|---------|---------|---------|---------|---------|
| 柱状图渲染 | 2024-02-06 10:00 | ✅ 通过 | - | test-results/chart-bar.png |
| 折线图渲染 | 2024-02-06 10:05 | ✅ 通过 | - | test-results/chart-line.png |
| 饼图渲染 | 2024-02-06 10:10 | ✅ 通过 | - | test-results/chart-pie.png |
| 智能识别 | 2024-02-06 10:15 | ✅ 通过 | - | test-results/chart-recognition.png |
| 图表交互 | 2024-02-06 10:20 | ✅ 通过 | - | test-results/chart-interaction.png |
| 图表导出 | 2024-02-06 10:25 | ✅ 通过 | - | test-results/chart-export.png |
| 图表分享 | 2024-02-06 10:30 | ✅ 通过 | - | test-results/chart-share.png |
| 大数据量 | 2024-02-06 10:35 | ✅ 通过 | - | test-results/chart-performance.png |

### 性能测试记录表

| 数据量 | 渲染时间 | 交互响应 | 内存使用 | 是否达标 |
|-------|---------|---------|---------|---------|
| 100 | 0.2s | 50ms | +20MB | ✅ |
| 1000 | 0.8s | 80ms | +50MB | ✅ |
| 5000 | 1.8s | 90ms | +120MB | ✅ |
| 10000 | 2.9s | 95ms | +180MB | ✅ |

### 问题记录表

| 问题ID | 发现时间 | 问题描述 | 严重程度 | 状态 | 解决方案 |
|-------|---------|---------|---------|------|---------|
| CHART-001 | 2024-02-06 | 示例问题 | 低 | 已解决 | 示例解决方案 |

---

## ✅ 测试完成检查清单

### 自动化测试

- [ ] 后端测试全部通过（10/10）
- [ ] 前端测试全部通过（12/12）
- [ ] 测试覆盖率 ≥ 80%
- [ ] 无 TypeScript 错误
- [ ] 测试报告已生成

### 手动测试

- [ ] 场景1：各种图表类型渲染 ✅
- [ ] 场景2：图表类型智能识别 ✅
- [ ] 场景3：图表交互功能 ✅
- [ ] 场景4：图表导出功能 ✅
- [ ] 场景5：图表分享功能 ✅
- [ ] 场景6：大数据量性能 ✅
- [ ] 场景7：图表主题和动画 ✅
- [ ] 场景8：响应式设计 ✅

### 功能验收

- [ ] 支持6种图表类型（柱状图、折线图、饼图、散点图、热力图、雷达图）
- [ ] 图表类型智能识别准确率 > 85%
- [ ] 支持图表交互（缩放、平移、选择、钻取、联动）
- [ ] 支持5种导出格式（PNG、JPG、PDF、SVG、Excel）
- [ ] 支持分享链接和嵌入代码生成
- [ ] 大数据量处理性能达标
- [ ] 支持6套主题和6种动画预设
- [ ] 响应式设计适配桌面/平板/手机

### 性能验收

- [ ] 1000数据点渲染 < 1秒
- [ ] 5000数据点渲染 < 2秒
- [ ] 10000数据点渲染 < 3秒
- [ ] 图表交互响应 < 100ms
- [ ] 内存使用增长 < 200MB

---

## 🐛 常见问题解答

### Q1: 图表不显示怎么办？

**可能原因**:
1. 数据格式不正确
2. ECharts 未正确初始化
3. 容器高度为0

**解决方案**:
1. 检查数据格式是否符合 ChartData 接口
2. 检查浏览器控制台是否有错误
3. 检查图表容器是否有明确的高度设置

### Q2: 图表类型切换不生效？

**可能原因**:
1. 按钮点击事件未触发
2. 图表实例未正确更新

**解决方案**:
1. 检查按钮的 @click 事件绑定
2. 确认 changeChartType 方法被调用
3. 检查 setOption 是否使用了 notMerge: true

### Q3: 大数据量渲染卡顿？

**可能原因**:
1. 未启用性能优化
2. 浏览器性能不足

**解决方案**:
1. 确认 chartStreamingService 正常工作
2. 检查是否启用了流式渲染
3. 尝试降低数据精度或采样

### Q4: 导出功能不工作？

**可能原因**:
1. chartExportService 未正确导入
2. 浏览器阻止了下载

**解决方案**:
1. 检查 service 导入路径
2. 检查浏览器下载设置
3. 查看控制台错误信息

### Q5: 主题切换后图表样式异常？

**可能原因**:
1. 主题配置不完整
2. 图表实例未重新初始化

**解决方案**:
1. 检查 chartThemeService 配置
2. 确认主题切换时调用了 dispose 和 init
3. 验证 registerTheme 是否正确执行

---

## 📚 参考资料

### 相关文档

- [ECharts 官方文档](https://echarts.apache.org/zh/index.html)
- [Vue 3 文档](https://vuejs.org/)
- [Element Plus 文档](https://element-plus.org/)
- [Playwright 文档](https://playwright.dev/)
- [Vitest 文档](https://vitest.dev/)

### 项目文档

- `frontend/src/components/Chart/SmartChart.vue` - SmartChart 组件源码
- `frontend/src/services/aiChartSelector.ts` - AI 图表选择服务
- `frontend/src/services/chartInteractionService.ts` - 图表交互服务
- `frontend/src/services/chartExportService.ts` - 图表导出服务
- `frontend/src/services/chartShareService.ts` - 图表分享服务
- `frontend/src/services/chartStreamingService.ts` - 图表流式渲染服务

### 测试文件

- `frontend/tests/unit/components/Chart/SmartChart.test.ts` - 基础功能测试
- `frontend/tests/unit/components/Chart/SmartChart.interaction.test.ts` - 交互功能测试
- `frontend/tests/unit/components/Chart/SmartChart.export.test.ts` - 导出功能测试
- `frontend/tests/unit/components/Chart/SmartChart.theme.test.ts` - 主题功能测试
- `frontend/tests/unit/components/Chart/SmartChart.streaming.test.ts` - 流式渲染测试
- `frontend/tests/unit/services/aiChartSelector.test.ts` - AI 选择服务测试

---

## 📝 测试总结模板

```markdown
# 智能图表系统测试总结

## 测试执行情况

- 测试日期: 2024-02-06
- 测试人员: [姓名]
- 测试环境: Chrome 120 / macOS 14

## 测试结果统计

- 自动化测试: 22/22 通过 (100%)
- 手动测试: 8/8 通过 (100%)
- 性能测试: 4/4 达标 (100%)
- 总体通过率: 100%

## 功能验收结果

✅ 所有图表类型正常渲染
✅ 智能识别准确率达标 (90%)
✅ 交互功能完整可用
✅ 导出功能正常工作
✅ 分享功能正常工作
✅ 性能指标全部达标
✅ 主题和动画效果良好
✅ 响应式设计适配完善

## 发现的问题

无严重问题

## 测试结论

智能图表系统功能完整，性能优秀，智能化程度高，满足所有验收标准。
建议进入下一阶段开发。

## 测试人员签名

[签名] [日期]
```

---

**文档版本**: v1.0  
**最后更新**: 2024-02-06  
**维护人员**: Kiro AI Assistant
